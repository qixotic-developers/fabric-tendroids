= CLion Setup Guide
:toc: left
:toclevels: 3
:icons: font

Quick reference for configuring CLion with Visual Studio 2022 for C++ extension development.

== First Time Setup

=== 1. Open Project in CLion

----
File â†’ Open â†’ C:\Dev\Omniverse\fabric-tendroids\exts\qixotic.tendroids\qixotic\tendroids\cpp
----

CLion will detect the `CMakeLists.txt` and start configuring.

=== 2. Configure Toolchain

*Settings â†’ Build, Execution, Deployment â†’ Toolchains*

* *Toolchain:* Visual Studio
* *Architecture:* amd64
* *Version:* 17.0 (VS 2022)

Click *Detect* to auto-configure paths.

=== 3. Configure CMake Profile

*Settings â†’ Build, Execution, Deployment â†’ CMake*

Create a *Release* profile:

* *Name:* Release
* *Build type:* Release
* *Generator:* Default (Ninja or Visual Studio)
* *CMake options:*
+
----
-DKIT_SDK_PATH="C:/Users/YOUR_USERNAME/AppData/Local/ov/pkg/composer-2024.1.0"
----

=== 4. Install pybind11

In CLion's terminal:

[source,bash]
----
pip install pybind11
----

== Building

=== CLion UI

* *Build â†’ Build Project* (Ctrl+F9)
* Or click the hammer icon ðŸ”¨

=== Terminal

[source,bash]
----
# From cpp/ directory
mkdir cmake-build-release
cd cmake-build-release
cmake .. -G "Visual Studio 17 2022" -A x64
cmake --build . --config Release
----

== Running Tests

=== CLion Terminal

[source,bash]
----
cd ..
python test_phase1.py
----

=== External Terminal

[source,bash]
----
cd C:\Dev\Omniverse\fabric-tendroids\exts\qixotic.tendroids\qixotic\tendroids
python test_phase1.py
----

== Common Issues

=== Issue: "Could not find pybind11"

*Solution:*

[source,bash]
----
pip install pybind11
# Then reload CMake: Tools â†’ CMake â†’ Reload CMake Project
----

=== Issue: "Kit SDK not found"

*Solution:* Update CMakeLists.txt:

[source,cmake]
----
set(KIT_SDK_PATH "C:/Users/YOUR_USERNAME/AppData/Local/ov/pkg/YOUR_KIT_VERSION" 
    CACHE PATH "Kit SDK installation path")
----

Or set via CMake options in CLion settings.

=== Issue: Python version mismatch

*Solution:* Verify Python version:

[source,bash]
----
python --version  # Should be 3.10.x
----

If wrong, use Kit SDK Python directly:

[source,bash]
----
C:/Users/YOUR_USERNAME/AppData/Local/ov/pkg/composer-2024.1.0/python.bat test_phase1.py
----

=== Issue: Build succeeds but import fails

*Solution:* Check output location:

[source,bash]
----
# Should exist:
cpp/cmake-build-release/Release/fast_mesh_updater.pyd

# If in different location, update test_phase1.py search paths
----

== Debugging

=== Enable Debug Build

In CMake settings, change *Build type* to `Debug`, rebuild, then:

[source,bash]
----
python test_phase1.py
----

Attach CLion debugger to Python process if needed.

=== CMake Debug Output

Add to CMakeLists.txt temporarily:

[source,cmake]
----
message(STATUS "Python: ${Python3_EXECUTABLE}")
message(STATUS "pybind11: ${pybind11_VERSION}")
message(STATUS "Kit SDK: ${KIT_SDK_PATH}")
----

== Workflow

[plantuml, clion-workflow, svg]
----
@startuml
!theme plain
skinparam backgroundColor #FEFEFE

start

:Edit C++ code in CLion;

:Build (Ctrl+F9);
note right: Compiles to .pyd

:Test in terminal;
note right
  python test_phase1.py
end note

if (Tests pass?) then (yes)
  :Commit changes;
  stop
else (no)
  :Review errors;
  note right
    - Check build output
    - Check test output
    - Debug if needed
  end note
endif

@enduml
----

. *Edit C++ code* in CLion
. *Build* (Ctrl+F9)
. *Test* in terminal: `python test_phase1.py`
. *Iterate*

== Hot Reload

Python caches imported modules. To test changes:

[source,python]
----
# In Python console/script
import sys
if 'fast_mesh_updater' in sys.modules:
    del sys.modules['fast_mesh_updater']
import fast_mesh_updater  # Fresh import
----

Or restart Python interpreter between tests.

== Next Steps After Phase 1

Once tests pass:

. Commit Phase 1 files
. Create Phase 2 branch
. Add numpy array support
. Integrate USD stage access

== Quick Reference

[cols="2,3"]
|===
|Action |Command

|Open project
|File â†’ Open â†’ cpp/

|Configure CMake
|Settings â†’ Build â†’ CMake

|Build
|Ctrl+F9 or Build â†’ Build Project

|Clean build
|Build â†’ Clean

|Reload CMake
|Tools â†’ CMake â†’ Reload CMake Project

|Run tests
|`cd .. && python test_phase1.py`

|View build output
|Build tool window (Alt+4)
|===

'''

*Need help?* Check main README.adoc or Tendroids documentation.
