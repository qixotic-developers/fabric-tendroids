= Phase 2D Quick Start - Bubble System
:toc:

== TL;DR

Bubble system is READY! ðŸŽ‰

* âœ… All files created and integrated
* âœ… Configuration in `config/tendroids_config.json`
* âœ… Works with single or multiple tendroids
* âœ… Fully parameterized for tuning

== Quick Test

[source,python]
----
from qixotic.tendroids.scene import TendroidSceneManager

# Create scene manager
scene_manager = TendroidSceneManager()

# Create single tendroid (bubbles auto-enabled from config)
scene_manager.create_single_tendroid()

# Start animation
scene_manager.start_animation(enable_profiling=True)

# Watch for bubbles! They emit when breathing wave reaches top.
----

== Key Files Created

[cols="1,2"]
|===
|File |Purpose

|`bubbles/__init__.py`
|Module exports

|`bubbles/bubble_config.py` (100 lines)
|All tunable parameters + JSON loader

|`bubbles/bubble.py` (120 lines)
|Individual bubble with physics

|`bubbles/bubble_helpers.py` (90 lines)
|USD sphere creation + materials

|`bubbles/bubble_manager.py` (150 lines)
|Central coordinator for all bubbles

|`config/tendroids_config.json`
|Added `bubble_system` section

|`test_phase2d_bubbles.py`
|Test script for single tendroid

|`PHASE2D_BUBBLE_SYSTEM.adoc`
|Complete documentation
|===

== Key Changes to Existing Files

=== `core/tendroid.py`
* Added `bubble_manager` parameter
* Added `_emit_bubble()` method
* Integrated bubble emission in `_update_vertex_deform()`
* Passes absolute time for bubble timing

=== `scene/animation_controller.py`
* Added `bubble_manager` parameter
* Tracks `_absolute_time` for emission timing
* Updates bubbles in `_on_update()`
* Shows bubble count in profiling logs

=== `scene/tendroid_factory.py`
* Added `bubble_manager` parameter to both methods
* Passes bubble_manager to all created Tendroids

=== `scene/manager.py`
* Creates BubbleManager in `_ensure_bubble_manager()`
* Loads config from JSON
* Wires bubble_manager to animation controller
* Passes bubble_manager to factory
* Added `get_bubble_count()` method

== Tuning Parameters

Edit `config/tendroids_config.json` â†’ `bubble_system`:

[cols="1,1,2"]
|===
|Parameter |Default |Effect

|`enabled`
|`true`
|Enable/disable entire system

|`emission_threshold`
|`0.90`
|When bubble starts (0.0-1.0 of length)

|`release_threshold`
|`0.95`
|When bubble breaks free

|`diameter_multiplier`
|`1.0`
|Scale bubble size vs max deformation

|`rise_speed`
|`30.0`
|Upward velocity (units/sec)

|`drift_speed`
|`2.0`
|Lateral drift (units/sec)

|`wobble_frequency`
|`0.5`
|Size variation cycles/sec

|`color`
|`[0.7, 0.9, 1.0]`
|Light cyan RGB

|`opacity`
|`0.4`
|Transparency (0.0-1.0)

|`max_bubbles_per_tendroid`
|`5`
|Prevent explosion
|===

== How It Works

1. **Emission**: When `BreathingAnimator.should_emit_bubble()` returns true (wave at 95% of length)
2. **Creation**: `BubbleManager.emit_bubble()` creates sphere at tendroid top
3. **Physics**: Each bubble rises with drift and wobble
4. **Cleanup**: Auto-despawn when reaching height limit or max lifetime

== Testing Workflow

=== Single Tendroid Test
[source,bash]
----
1. Load USD Composer
2. Run test_phase2d_bubbles.py
3. Watch tendroid breathe and emit bubbles
4. Check console for FPS and bubble count
----

=== 15 Tendroid Test
[source,python]
----
scene_manager = TendroidSceneManager()
scene_manager.create_tendroids(count=15)
scene_manager.start_animation(enable_profiling=True)

# Monitor:
# - FPS (should stay >40fps)
# - Bubble count (max 5 per tendroid = 75 total)
# - Visual quality
----

== Debug Mode

Set in config:
[source,json]
----
"bubble_system": {
  "debug_logging": true,
  ...
}
----

This logs:
* Bubble creation
* Emission events
* Cleanup events
* Bubble counts

== Performance Targets

|===
|Metric |Target |Notes

|FPS with 1 tendroid
|>50fps
|Baseline

|FPS with 15 tendroids
|>40fps
|Production target

|Bubble overhead
|<5ms/frame
|Max acceptable

|Max bubbles (15 tendroids)
|75 (5 each)
|Configurable limit
|===

== Next Actions

1. âœ… **DONE**: All files created and integrated
2. **TODO**: Test with single tendroid, verify bubbles appear
3. **TODO**: Tune parameters for realistic appearance
4. **TODO**: Test with 15 tendroids, measure performance
5. **TODO**: Optimize if needed (reduce resolution, wobble frequency, etc.)

== Common Issues & Solutions

=== Bubbles Not Appearing
* Check `bubble_system.enabled = true` in config
* Verify tendroid is animating (breathing wave active)
* Check console for bubble emission logs
* Enable `debug_logging` to see detailed events

=== Too Many Bubbles
* Reduce `max_bubbles_per_tendroid`
* Increase `release_threshold` (less frequent emission)
* Increase `rise_speed` (faster despawn)

=== Performance Issues
* Reduce `resolution` (fewer sphere vertices)
* Reduce `max_bubbles_per_tendroid`
* Disable `wobble` effects (set amplitude to 0)

== File Sizes

All files within 100-150 line guideline:
* `bubble_config.py`: ~100 lines
* `bubble.py`: ~120 lines
* `bubble_helpers.py`: ~90 lines
* `bubble_manager.py`: ~150 lines

Total bubble system: ~460 lines of focused, modular code.

== Success! ðŸŽ‰

The bubble system is complete and ready for testing. All parameters are exposed in JSON config for easy tuning without code changes. The architecture is clean, modular, and maintains the 100-150 lines per file guideline.

**Start with single tendroid test, tune parameters, then scale to 15!**
