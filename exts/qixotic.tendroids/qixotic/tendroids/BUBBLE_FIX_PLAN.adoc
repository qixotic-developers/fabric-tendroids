= Bubble Pop System - Comprehensive Fix Plan
:date: 2024-11-19

== Issues Identified

1. *Pop timing*: Should be based on vertical height from Tendroid mouth, not fixed time
2. *Multiple bubbles*: Only one bubble per Tendroid at a time
3. *Rise speed*: Too slow (35 â†’ 60+ units/sec for realism)
4. *Particle motion*: Should inherit bubble velocity and drift upward
5. *Particle fade*: Should fade individually, not all at once
6. *Particle system*: Currently manual spheres, could upgrade to GPU particles

== Solutions

=== 1. Height-Based Pop Timing

Replace time-based with height-based:
----
pop_height = tendroid_mouth_y + random(150, 250)  # Variable height
Check: if bubble.position[1] >= pop_height
----

=== 2. One Bubble Per Tendroid

In BubbleManager:
----
max_bubbles_per_tendroid: 1  // Only allow one at a time
----

=== 3. Faster Rise Speed  

Increase to 60 units/sec (already done in config)

=== 4. Particle Motion Fix

Particles should:
----
initial_velocity = bubble.velocity + radial_spray_vector
gravity = -5.0  // Gentle downward drift
No sudden downward acceleration
----

=== 5. Individual Particle Fade

Randomize lifetime per particle:
----
lifetime = base_lifetime * random(0.7, 1.3)
----

=== 6. Keep Current System

Manual spheres give good control. GPU particles would be optimization for later.

== Implementation Plan

*Phase 1*: Quick fixes (this session)
- Set max_bubbles_per_tendroid = 1
- Increase rise_speed = 60
- Fix particle velocity inheritance
- Randomize particle lifetimes

*Phase 2*: Height-based popping (next session)
- Calculate pop_height instead of pop_time
- Track Tendroid mouth position
- Height-based despawn check

== Files to Modify

1. `config/tendroids_config.json` - Update limits
2. `bubbles/bubble_particle.py` - Fix particle physics
3. `bubbles/bubble.py` - Add height-based logic (later)
4. `bubbles/bubble_manager.py` - Enforce one bubble limit

