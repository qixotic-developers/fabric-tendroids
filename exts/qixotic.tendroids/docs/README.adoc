= Tendroids Extension
:toc:
:toclevels: 2

== Overview

Tendroids is an Omniverse extension for creating and animating interactive cylinder-based wormlike sea creatures. It uses Warp GPU kernels for high-performance vertex deformation and supports real-time animation at 60fps with 15 creatures.

== Features

* *Procedural Geometry*: Dynamically generated cylinder meshes with flared bases
* *Warp GPU Deformation*: Smooth breathing animation using NVIDIA Warp kernels
* *Material Safety*: Automatic glass material detection to prevent GPU crashes
* *Performance Optimized*: Targets 60fps with 15 creatures using GPU acceleration
* *Refactored Architecture*: Clean separation of concerns with ~2,200 lines across 16 focused modules
* *Simple UI*: Easy-to-use control panel for spawning and managing Tendroids

== Installation

=== Requirements

* NVIDIA Omniverse (Composer or Create)
* Python 3.10+
* NVIDIA Warp (for GPU acceleration)
* CUDA-capable GPU (recommended)

=== Setup

1. Copy the extension folder to your Omniverse extensions directory:
+
----
<omniverse-app>/exts/qixotic.tendroids/
----

2. Enable the extension in Omniverse:
+
* Open Extension Manager (Window → Extensions)
* Search for "Tendroids"
* Enable the extension

== Quick Start

=== Basic Usage

1. *Open Tendroid Controls window* (Window → Tendroid Controls)
2. *Configure spawn settings*:
   - Count: Number of Tendroids (1 for detailed controls, 2+ for batch)
   - Single Mode: Diameter, length, wave parameters, amplitude
   - Multi Mode: Area width/depth, segments
3. *Click "Spawn Tendroids"* to create creatures
4. *Click "Start Animation"* to begin breathing animation
5. *Click "Stop Animation"* to pause
6. *Click "Clear All"* to remove all Tendroids

=== Performance Tips

* Start with 5-10 Tendroids to test performance
* Reduce segment count (12-16) for better performance
* Avoid glass/transparent materials (causes GPU crashes)
* GPU acceleration provides best performance

== Architecture

=== Refactored Module Structure

The extension has been refactored for clean separation of concerns:

----
qixotic.tendroids/
├── core/                      # Core Tendroid classes (7 modules)
│   ├── tendroid.py            # Main Tendroid class (~165 lines)
│   ├── tendroid_builder.py    # USD creation logic (~145 lines)
│   ├── tendroid_lifecycle.py  # Lifecycle management (~126 lines)
│   ├── material_safety.py     # Glass detection (~133 lines)
│   ├── mesh_updater.py        # Vertex updates (~57 lines)
│   ├── cylinder_generator.py  # Procedural geometry (~200 lines)
│   └── warp_deformer.py       # GPU deformation (~250 lines)
├── scene/                     # Scene management (3 modules)
│   ├── manager.py             # Scene coordinator (~165 lines)
│   ├── tendroid_factory.py    # Creation patterns (~136 lines)
│   └── animation_controller.py # Animation lifecycle (~98 lines)
├── animation/                 # Animation systems (1 module)
│   └── breathing.py           # Breathing wave (~180 lines)
├── ui/                        # User interface (4 modules)
│   ├── control_panel.py       # UI coordinator (~102 lines)
│   ├── spawn_settings_ui.py   # Parameter controls (~179 lines)
│   ├── action_buttons.py      # Button handlers (~180 lines)
│   └── status_display.py      # Status labels (~61 lines)
└── utils/                     # Utilities (1 module)
    └── math_helpers.py        # Math functions
----

=== Refactoring Results

* **control_panel.py**: 401 → 102 lines (-75%)
* **tendroid.py**: 325 → 165 lines (-50%)
* **manager.py**: 269 → 165 lines (-39%)
* **9 new focused modules** created for clean separation
* **All files under 200 lines** for maintainability

=== Animation System

==== Breathing Animation (Warp-Based Vertex Deformation)

* GPU-accelerated vertex deformation using NVIDIA Warp kernels
* Traveling sine wave with smooth Gaussian envelope
* Wave travels from base to tip creating organic bulge effect
* Positive expansion only (no contraction)
* Configurable parameters:
  - Wave speed: Travel speed up the Tendroid (units/sec)
  - Bulge length: Size of wave as % of total length
  - Amplitude: Maximum radial expansion (0.35 = 35%)
  - Cycle delay: Pause between breathing cycles (seconds)

==== Material Safety System

* **CRITICAL**: Automatic detection of glass/transparent materials
* Glass materials can cause GPU crashes with dynamic geometry
* Periodic checking every 30 frames
* Animation automatically blocked when unsafe materials detected
* Logs warnings when glass materials applied
* Prevents GPU memory exceptions

==== Performance

* Target: 60 FPS with 15 Tendroids
* GPU-accelerated deformation for optimal performance
* Graceful fallback to CPU mode if GPU unavailable
* Fabric/USDRT integration for fast USD updates (when available)

== Configuration

=== Tendroid Parameters (Single Mode)

[cols="1,2,1"]
|===
|Parameter |Description |Default

|`diameter`
|Initial cylinder diameter
|20.0

|`length`
|Total height
|100.0

|`num_segments`
|Vertical resolution
|32

|`wave_size`
|Bulge length (% of total)
|40%

|`amplitude`
|Radial expansion
|0.35 (35%)

|`wave_speed`
|Wave travel speed
|40.0

|`pause`
|Delay between cycles
|2.0 sec
|===

=== Multi-Spawn Parameters

[cols="1,2,1"]
|===
|Parameter |Description |Default

|`count`
|Number of Tendroids
|1-15

|`area_width`
|Spawn region width
|200

|`area_depth`
|Spawn region depth
|200

|`segments`
|Segments per Tendroid
|16
|===

== Troubleshooting

=== Common Issues

==== Extension Won't Load

* Check Omniverse version compatibility
* Verify extension.toml is correct
* Check console for Python errors
* Ensure Warp is installed

==== Poor Performance

* Reduce Tendroid count
* Decrease segment count (12-16)
* Check if GPU acceleration is active
* Close other extensions
* Verify CUDA is available

==== Animation Not Updating

* Ensure "Start Animation" was clicked
* Check console for errors
* Verify stage is valid
* Check if glass material is applied (blocks animation)

==== Glass Material Warning

* CRITICAL: Do not use glass/transparent materials with Tendroids
* Will cause GPU crashes with dynamic geometry
* Animation is automatically blocked for safety
* Apply glass materials AFTER testing animation
* Use opaque materials during development

== Development

=== Architecture Patterns

* **Builder Pattern**: TendroidBuilder separates USD creation
* **Factory Pattern**: TendroidFactory handles instantiation
* **Lifecycle Pattern**: TendroidLifecycle manages state
* **Safety Pattern**: MaterialSafetyChecker prevents GPU crashes
* **Component Pattern**: Clean separation of UI, scene, core

=== Code Quality

* All modules under 200 lines
* Single Responsibility Principle
* High cohesion, low coupling
* Comprehensive documentation
* PlantUML diagrams for architecture

== API Reference

=== TendroidSceneManager

Primary interface for managing Tendroids.

==== Methods

`create_tendroids(count, spawn_area, radius_range, length_range, num_segments)`::
Create multiple Tendroids with random positions and sizes.

`create_single_tendroid(position, radius, length, params)`::
Create a single Tendroid with custom parameters.

`start_animation()`::
Begin animating all Tendroids.

`stop_animation()`::
Pause animation.

`clear_tendroids(stage)`::
Remove all Tendroids from scene.

=== Tendroid

Individual Tendroid creature.

==== Methods

`create(stage, parent_path)`::
Create Tendroid geometry in USD stage. Delegates to TendroidBuilder.

`update(dt)`::
Update animation for one frame. Checks material safety periodically.

`set_active(active)`::
Enable/disable this Tendroid (respects material safety).

`destroy(stage)`::
Remove from scene. Delegates to TendroidLifecycle.

`is_animation_enabled()`::
Check if animation is safe (not blocked by glass material).

=== TendroidBuilder (Static)

Builder for USD geometry creation.

==== Methods

`create_in_stage(tendroid, stage, parent_path)`::
Create all USD geometry and initialize components.

=== MaterialSafetyChecker

Glass material detection system.

==== Methods

`check_material()`::
Scan mesh for glass/transparent materials.

`should_check_now()`::
Check if periodic scan is due.

`is_safe_for_animation()`::
Return whether animation should proceed.

== Support

For issues, questions, or contributions:

* Project repository: (Add your repo URL)
* Documentation: README.adoc, PROJECT_OVERVIEW.adoc, IMPLEMENTATION_STATUS.adoc
* PlantUML diagrams: docs/plantUml/

== License

(Add your license information)

== Credits

Developed by Qixotic Software
Built with NVIDIA Omniverse
GPU acceleration via NVIDIA Warp
