= Fixed Interaction Behavior
:toc:

== Visual Diagram

```
BEFORE (BROKEN):
==================
Creature at 50 units → target_angle = 0° → NO BEND ❌
Creature at 30 units → target_angle = 0° → NO BEND ❌
Creature at 10 units → target_angle = 0° → NO BEND ❌
Creature overlaps   → repulsion = LEFT  → PULLS IN ❌


AFTER (FIXED):
================
Creature at 50 units → closeness=0.00 → target=0°     →      ○
                       (just entered zone)                    
                       
Creature at 40 units → closeness=0.25 → target=6.25°  →     ╱○
                       (starting to bend)                   ╱
                       
Creature at 30 units → closeness=0.50 → target=12.5°  →   ╱╱○
                       (moderate bend)                    ╱╱
                       
Creature at 20 units → closeness=0.75 → target=18.75° → ╱╱╱○
                       (strong bend)                   ╱╱╱
                       
Creature at 10 units → closeness=1.00 → target=25°    →╱╱╱╱○
                       (maximum bend)                 ╱╱╱╱
                       + repulsion starts
                       
Creature overlaps    → repulsion = RIGHT → PUSHES OUT ✅
```

== Distance vs. Angle Graph

```
Avoidance Angle (degrees)
    25° │                          ╱────────
        │                       ╱╱
    20° │                    ╱╱
        │                 ╱╱
    15° │              ╱╱
        │           ╱╱
    10° │        ╱╱
        │     ╱╱
     5° │  ╱╱
        │╱
     0° └────────────────────────────────────
        10   20   30   40   50  Distance (units)
        └─┬──┘└──────┬────────┘└─┬─┘
       Contact  Avoidance    Detection
                 Zone          Edge
```

== Repulsion Force Graph

```
Repulsion Force (units/sec²)
   100 │     ╱─────────
       │    ╱
    75 │   ╱
       │  ╱
    50 │ ╱
       │╱
    25 ╱
       ╱
     0 └──────────────────────────
       6  8  10  12  14  16  18  20  Distance (units)
       └┬─┘└──┬──┘└─────┬──────┘
      Full  Scaling   Inactive
      Force  Region
```

== Correct Repulsion Direction

```
Example 1: Creature to the RIGHT
─────────────────────────────────

    Tendroid         Creature
    at (0,0)         at (20,0)
       ○      →→→       X
                  
    Direction Vector:
    dx = 20 - 0 = 20
    dz = 0 - 0 = 0
    horiz_dir = (1, 0)  ← Points RIGHT (toward creature)
    
    Repulsion:
    repulsion_dir = horiz_dir = (1, 0)  ← Points RIGHT
    force = (1, 0) * 100 = (100, 0)      ← Pushes RIGHT
    
    Result: Creature pushed RIGHT (away) ✅


Example 2: Creature to the LEFT
────────────────────────────────

       Creature      Tendroid
       at (-20,0)    at (0,0)
          X      ←←←    ○
                  
    Direction Vector:
    dx = -20 - 0 = -20
    dz = 0 - 0 = 0
    horiz_dir = (-1, 0)  ← Points LEFT (toward creature)
    
    Repulsion:
    repulsion_dir = horiz_dir = (-1, 0)  ← Points LEFT
    force = (-1, 0) * 100 = (-100, 0)    ← Pushes LEFT
    
    Result: Creature pushed LEFT (away) ✅


Example 3: Creature ABOVE (Z+)
───────────────────────────────

       Creature
       at (0,30)
          X
          ↑
          ↑
          ↑
       Tendroid
       at (0,0)
          ○
                  
    Direction Vector:
    dx = 0 - 0 = 0
    dz = 30 - 0 = 30
    horiz_dir = (0, 1)  ← Points UP (toward creature)
    
    Repulsion:
    repulsion_dir = horiz_dir = (0, 1)  ← Points UP
    force = (0, 100)                    ← Pushes UP
    
    Result: Creature pushed UP (away) ✅
```

== Closeness Factor Calculation

```python
# Example values
detection_start = 50.0
contact_distance = 10.0  # creature_radius(6) + tendroid_radius(4)
distance = 30.0  # current distance

# Calculate closeness (0.0 to 1.0)
if distance >= detection_start:
    closeness = 0.0  # Too far
elif distance <= contact_distance:
    closeness = 1.0  # At or past contact
else:
    # Linear interpolation
    range = detection_start - contact_distance  # 50 - 10 = 40
    remaining = distance - contact_distance      # 30 - 10 = 20
    closeness = 1.0 - (remaining / range)        # 1.0 - (20/40) = 0.5

# Apply to angle
max_angle = 25.0
target_angle = closeness * max_angle  # 0.5 * 25 = 12.5°
```

== Step-by-Step Trace

```
Frame 1: Creature enters detection zone
────────────────────────────────────────
Distance: 50.0
Closeness: 0.0
Target angle: 0.0°
Current angle: 0.0°
Action: Suppress bubbles, log message
Result: No visible bend yet


Frame 10: Creature gets closer
───────────────────────────────
Distance: 40.0
Closeness: 0.25
Target angle: 6.25°
Current angle: 2.5° (growing at 30°/sec)
Action: Continue bending
Result: Slight lean visible


Frame 30: Creature halfway to contact
──────────────────────────────────────
Distance: 30.0
Closeness: 0.5
Target angle: 12.5°
Current angle: 12.0° (approaching target)
Action: Continue bending
Result: Obvious lean


Frame 50: Creature near contact
────────────────────────────────
Distance: 15.0
Closeness: 0.875
Target angle: 21.9°
Current angle: 21.5°
Action: Strong bend + mild repulsion
Result: Maximum lean, creature slowing


Frame 60: Contact!
──────────────────
Distance: 10.0
Closeness: 1.0
Target angle: 25.0° (max)
Current angle: 25.0°
Repulsion force: 100 units/sec² (max)
Shock: TRIGGERED
Result: Orange flash, strong pushback
```

== Quick Reference

**Avoidance starts:** 50 units (detection range)
**Maximum bend:** 25 degrees (at contact)
**Bend rate:** 30 deg/sec (base) + approach speed bonus
**Repulsion starts:** ~12 units (contact + buffer + range)
**Max repulsion:** 100 units/sec² (at penetration)
**Shock cooldown:** 1.5 seconds between shocks
**Bubble suppression:** Throughout entire interaction zone
