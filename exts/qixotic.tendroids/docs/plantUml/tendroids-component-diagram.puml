@startuml
title Tendroids Project - Component Diagram: Refactored System Architecture

skinparam componentStyle rectangle

package "Omniverse USD Composer" {
    [Viewport] as Viewport
    [Stage Manager] as StageManager
    [Extensions System] as ExtSystem
}

package "Tendroids Extension (Refactored)" {
    component "UI Layer (4 modules)" {
        [Control Panel\n~102 lines] as UI
        [Spawn Settings UI\n~179 lines] as SpawnUI
        [Action Buttons\n~180 lines] as Actions
        [Status Display\n~61 lines] as Status
    }

    component "Scene Management (3 modules)" {
        [Scene Manager\n~165 lines] as SceneMgr
        [Tendroid Factory\n~136 lines] as Factory
        [Animation Controller\n~98 lines] as AnimCtrl
    }

    component "Core - Tendroid (3 modules)" {
        [Tendroid\n~165 lines] as Tendroid
        [Tendroid Builder\n~145 lines] as Builder
        [Tendroid Lifecycle\n~126 lines] as Lifecycle
    }

    component "Core - Components (4 modules)" {
        [Material Safety Checker\n~133 lines] as Safety
        [Mesh Vertex Updater\n~57 lines] as Updater
        [Cylinder Generator\n~200 lines] as CylGen
        [Warp Deformer\n~250 lines] as WarpDef
    }

    component "Animation System (1 module)" {
        [Breathing Animator\n~180 lines] as Animator
    }
}

package "NVIDIA Technologies" {
    [Warp Runtime] as Warp
    [CUDA] as CUDA
    database "GPU Memory" as GPUMem
}

package "USD Framework" {
    [USD Stage API] as USDStage
    [UsdGeom] as USDGeom
    [UsdShade] as USDShade
}

' Connections - Extension Entry
ExtSystem --> UI : loads

' Connections - UI Layer
UI *-- SpawnUI : contains
UI *-- Actions : contains  
UI *-- Status : contains
Actions --> SceneMgr : controls
SpawnUI --> Actions : provides settings
Actions --> Status : updates

' Connections - Scene Management
SceneMgr *-- AnimCtrl : delegates animation
SceneMgr ..> Factory : creates tendroids via
AnimCtrl --> Tendroid : animates multiple

' Connections - Tendroid Core
Factory --> Tendroid : creates
Tendroid ..> Builder : delegates creation
Tendroid ..> Lifecycle : delegates lifecycle
Builder --> CylGen : generates mesh
Builder --> Safety : creates
Builder --> Updater : creates
Builder --> WarpDef : creates
Builder --> Animator : creates

' Connections - Component Usage
Tendroid --> Safety : monitors material
Tendroid --> Updater : updates vertices
Tendroid --> WarpDef : applies deformation
Tendroid --> Animator : gets wave params

' Connections - Geometry
CylGen --> USDGeom : creates mesh prims
Safety --> USDShade : checks materials

' Connections - GPU
WarpDef --> Warp : GPU operations
Warp --> CUDA : CUDA calls
Warp --> GPUMem : memory allocation

' Connections - USD
Updater --> USDGeom : vertex updates
USDGeom --> StageManager : stage updates
StageManager --> Viewport : viewport refresh

note right of UI
    Refactored from 401 lines
    to 4 focused modules:
    - Main coordinator (102)
    - Settings UI (179)
    - Action handlers (180)
    - Status display (61)
end note

note right of Tendroid
    Refactored from 325 lines
    to 3 focused modules:
    - Core logic (165)
    - Builder pattern (145)
    - Lifecycle methods (126)
end note

note right of SceneMgr
    Refactored from 269 lines
    to 3 focused modules:
    - Manager coordinator (165)
    - Factory pattern (136)
    - Animation control (98)
end note

note right of Safety
    CRITICAL component
    Detects glass/transparent
    materials that cause GPU
    crashes with dynamic geometry
    Periodic checking (every 30 frames)
end note

note bottom of WarpDef
    GPU-accelerated vertex
    deformation using NVIDIA Warp
    for smooth breathing animation
    (60fps target, 15 tendroids)
end note

note left of Factory
    Creation patterns:
    - Single tendroid with params
    - Batch creation with
      randomized positions
end note

@enduml
